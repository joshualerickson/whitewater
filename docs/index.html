<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Parallel Processing Options for USGS Data Retrieval • whitewater</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Parallel Processing Options for USGS Data Retrieval">
<meta property="og:description" content="Provides methods for retrieving USGS water data using sequential and parallel processing. In addition to parallel methods, data wrangling and additional statistical attributes are provided. ">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">whitewater</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-book"></span>
     
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/get_dv.html">Get Started</a>
    </li>
    <li>
      <a href="articles/parallel.html">Parallel</a>
    </li>
    <li>
      <a href="articles/stats.html">Stats</a>
    </li>
  </ul>
</li>
<li>
  <a href="reference/index.html">reference</a>
</li>
<li>
  <a href="https://github.com/joshualerickson/whitewater/" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
    github
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="whitewater">whitewater<a class="anchor" aria-label="anchor" href="#whitewater"></a>
</h1></div>
<!-- badges: start -->
<p>The goal of whitewater is to provide sequential and parallel processing for USGS stations in a tidy-style format. This package allows user to <code><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan()</a></code> their choice of parallel processing and then use the argument <code>parallel = TRUE</code> in whitewater function calls. The package also puts every output in a <code>tibble</code> with data munging of sites, parameter and stat codes, which results in a <strong>tidy</strong> style data frame.</p>
<div class="section level2">
<h2 id="attention">Attention!<a class="anchor" aria-label="anchor" href="#attention"></a>
</h2>
<p><strong>Due to potentially crashing (USGS Water Services)[<a href="https://waterservices.usgs.gov/" class="external-link uri">https://waterservices.usgs.gov/</a>] REST services parallel processing is kept to 120 requests/min. By following this rate limit, we can still benefit from parallel processing but also being mindful/respectful to the USGS Water Services via <a href="https://github.com/USGS-R/dataRetrieval" class="external-link">{dataRetrieval}</a> and REST services. Thank you!</strong></p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of whitewater from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.packages("devtools")</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/remote-reexports.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"joshualerickson/whitewater"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>This is a basic example which shows you how to solve a common problem: get daily values of discharge for multiple sites (all active sites in Pacific Northwest (Region 17)) using parallel processing. Please see <a href="https://cran.r-project.org/web/packages/furrr/index.html" class="external-link">furrr</a> and <a href="https://cran.r-project.org/web/packages/future/index.html" class="external-link">future</a> for more details on parallel processing methods.</p>
<div class="section level3">
<h3 id="running-in-parallel">Running in parallel<a class="anchor" aria-label="anchor" href="#running-in-parallel"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/joshualerickson/whitewater/" class="external-link">whitewater</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pubs.usgs.gov/tm/04/a10/" class="external-link">dataRetrieval</a></span><span class="op">)</span>

<span class="va">huc17_sites</span> <span class="op">&lt;-</span> <span class="fu">dataRetrieval</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dataRetrieval/man/whatNWISdata.html" class="external-link">whatNWISdata</a></span><span class="op">(</span>huc <span class="op">=</span> <span class="fl">17</span>,
                                           siteStatus <span class="op">=</span> <span class="st">'active'</span>,
                                           service <span class="op">=</span> <span class="st">'dv'</span>,
                                           parameterCd <span class="op">=</span> <span class="st">'00060'</span>,
                                           drainAreaMax <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"# of sites: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">huc17_sites</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # of sites:  675</span>

<span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">huc17_sites</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'dec_long_va'</span>, <span class="st">'dec_lat_va'</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/borders.html" class="external-link">borders</a></span><span class="op">(</span><span class="st">'state'</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">130</span>, <span class="op">-</span><span class="fl">110</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">50</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-2-1.png" width="75%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#need to call future::plan()</span>

<span class="co">##### Remember, please use 10 or less workers #####</span>
<span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="fu"><a href="https://future.futureverse.org/reference/multisession.html" class="external-link">multisession</a></span><span class="op">(</span>workers <span class="op">=</span> <span class="fl">11</span><span class="op">)</span><span class="op">)</span>

<span class="co">#running on 11 cores</span>

<span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span>
<span class="va">pnw_dv</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ww_dvUSGS.html">ww_dvUSGS</a></span><span class="op">(</span><span class="va">huc17_sites</span><span class="op">$</span><span class="va">site_no</span>,
                    parameter_cd <span class="op">=</span> <span class="st">'00060'</span>,
                    wy_month <span class="op">=</span> <span class="fl">10</span>,
                    parallel <span class="op">=</span> <span class="cn">TRUE</span>,
                    verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   39.96    2.47  559.56</span>

<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">pnw_dv</span><span class="op">)</span>
<span class="co">#&gt; [1] 11752061</span>

<span class="va">pnw_dv</span>
<span class="co">#&gt; # A tibble: 11,752,061 x 28</span>
<span class="co">#&gt;    Station site_no drainage_area   lat  long altitude agency_cd Date        Flow</span>
<span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;     &lt;date&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1 DONNER~ 103960~          124.  42.8 -119.     4254 USGS      1911-04-01   160</span>
<span class="co">#&gt;  2 DONNER~ 103960~          124.  42.8 -119.     4254 USGS      1911-04-02   166</span>
<span class="co">#&gt;  3 DONNER~ 103960~          124.  42.8 -119.     4254 USGS      1911-04-03   173</span>
<span class="co">#&gt;  4 DONNER~ 103960~          124.  42.8 -119.     4254 USGS      1911-04-04   180</span>
<span class="co">#&gt;  5 DONNER~ 103960~          124.  42.8 -119.     4254 USGS      1911-04-05   187</span>
<span class="co">#&gt;  6 DONNER~ 103960~          124.  42.8 -119.     4254 USGS      1911-04-06   232</span>
<span class="co">#&gt;  7 DONNER~ 103960~          124.  42.8 -119.     4254 USGS      1911-04-07   207</span>
<span class="co">#&gt;  8 DONNER~ 103960~          124.  42.8 -119.     4254 USGS      1911-04-08   182</span>
<span class="co">#&gt;  9 DONNER~ 103960~          124.  42.8 -119.     4254 USGS      1911-04-09   157</span>
<span class="co">#&gt; 10 DONNER~ 103960~          124.  42.8 -119.     4254 USGS      1911-04-10   132</span>
<span class="co">#&gt; # ... with 11,752,051 more rows, and 19 more variables: Flow_cd &lt;chr&gt;,</span>
<span class="co">#&gt; #   STILLING.WELL_Flow &lt;dbl&gt;, STILLING.WELL_Flow_cd &lt;chr&gt;,</span>
<span class="co">#&gt; #   .Estimated.By.Regression._Flow &lt;dbl&gt;,</span>
<span class="co">#&gt; #   .Estimated.By.Regression._Flow_cd &lt;chr&gt;, ..2.._Flow &lt;dbl&gt;,</span>
<span class="co">#&gt; #   ..2.._Flow_cd &lt;chr&gt;, .Discharge.1921.to.1952._Flow &lt;dbl&gt;,</span>
<span class="co">#&gt; #   .Discharge.1921.to.1952._Flow_cd &lt;chr&gt;, year &lt;dbl&gt;, month &lt;dbl&gt;, day &lt;int&gt;,</span>
<span class="co">#&gt; #   doy &lt;dbl&gt;, wy_doy &lt;dbl&gt;, month_day &lt;chr&gt;, wy &lt;int&gt;, month_abb &lt;fct&gt;, ...</span></code></pre></div>
<p>Now we can use other <code>ww_</code> functions to filter the data by water year, month, water year and month, as well as stat reporting (percentiles comparing current readings).</p>
</div>
<div class="section level3">
<h3 id="water-year">Water Year<a class="anchor" aria-label="anchor" href="#water-year"></a>
</h3>
<p>Same as above, we can just call <code>parallel = TRUE</code> to run in parallel since we’ll be getting peak flows from <code><a href="https://rdrr.io/pkg/dataRetrieval/man/readNWISpeak.html" class="external-link">dataRetrieval::readNWISpeak()</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span>
<span class="va">pnw_wy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="fu"><a href="reference/ww_wyUSGS.html">ww_wyUSGS</a></span><span class="op">(</span><span class="va">pnw_dv</span>,
                                     parallel <span class="op">=</span> <span class="cn">TRUE</span>,
                                     verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   16.86    0.72  418.25</span>

<span class="va">pnw_wy</span>
<span class="co">#&gt; # A tibble: 32,663 x 27</span>
<span class="co">#&gt;    Station   site_no    wy peak_va peak_dt    drainage_area   lat  long altitude</span>
<span class="co">#&gt;    &lt;chr&gt;     &lt;chr&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;date&gt;             &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt;  1 ABIQUA C~ 142007~  2014      NA NA                  45.3  45.0 -123.      193</span>
<span class="co">#&gt;  2 ABIQUA C~ 142007~  2015    3330 2014-12-21          45.3  45.0 -123.      193</span>
<span class="co">#&gt;  3 ABIQUA C~ 142007~  2016    5980 2015-12-07          45.3  45.0 -123.      193</span>
<span class="co">#&gt;  4 ABIQUA C~ 142007~  2017    3740 2017-03-09          45.3  45.0 -123.      193</span>
<span class="co">#&gt;  5 ABIQUA C~ 142007~  2018    4290 2017-10-22          45.3  45.0 -123.      193</span>
<span class="co">#&gt;  6 ABIQUA C~ 142007~  2019    3700 2019-04-07          45.3  45.0 -123.      193</span>
<span class="co">#&gt;  7 ABIQUA C~ 142007~  2020    2600 2020-01-28          45.3  45.0 -123.      193</span>
<span class="co">#&gt;  8 ABIQUA C~ 142007~  2021    5360 2020-12-20          45.3  45.0 -123.      193</span>
<span class="co">#&gt;  9 ABIQUA C~ 142007~  2022      NA NA                  45.3  45.0 -123.      193</span>
<span class="co">#&gt; 10 AHTANUM ~ 125025~  1904      NA NA                 107.   46.5 -120.      940</span>
<span class="co">#&gt; # ... with 32,653 more rows, and 18 more variables: obs_per_wy &lt;int&gt;,</span>
<span class="co">#&gt; #   wy_count &lt;int&gt;, Flow_sum &lt;dbl&gt;, Flow_max &lt;dbl&gt;, Flow_min &lt;dbl&gt;,</span>
<span class="co">#&gt; #   Flow_mean &lt;dbl&gt;, Flow_median &lt;dbl&gt;, Flow_stdev &lt;dbl&gt;, Flow_coef_var &lt;dbl&gt;,</span>
<span class="co">#&gt; #   Flow_max_dnorm &lt;dbl&gt;, Flow_min_dnorm &lt;dbl&gt;, Flow_mean_dnorm &lt;dbl&gt;,</span>
<span class="co">#&gt; #   Flow_med_dnorm &lt;dbl&gt;, Flow_max_sdnorm &lt;dbl&gt;, Flow_min_sdnorm &lt;dbl&gt;,</span>
<span class="co">#&gt; #   Flow_mean_sdnorm &lt;dbl&gt;, Flow_med_sdnorm &lt;dbl&gt;, Flow_sd_norm &lt;dbl&gt;</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-5-1.png" width="75%" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="without-using-parallel">Without using parallel<a class="anchor" aria-label="anchor" href="#without-using-parallel"></a>
</h3>
<p>If you just want a few sites (or one) and not use parallel processing, go for it! You’ll still get the advantages of filtering and stats. In addition, You don’t always have to pipe a <code><a href="reference/ww_dvUSGS.html">ww_dvUSGS()</a></code> object into the <code>ww_*()</code> and can just use the <code>sites</code> argument. In the example below I’ll do this but IMO its nice to start with a <code><a href="reference/ww_dvUSGS.html">ww_dvUSGS()</a></code> object because you’ll likely come back to it.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">withlacoochee_temp_and_flow</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ww_wyUSGS.html">ww_wyUSGS</a></span><span class="op">(</span>sites<span class="op">=</span><span class="st">"02319394"</span>,
                          parameter_cd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"00010"</span>, <span class="st">"00060"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; v 'water year' was successfully downloaded.</span>
<span class="co">#&gt; &gt; now starting to gather peak flows using dataRetrieval::readNWISpeak</span>
<span class="co">#&gt; v 02319394 'peak flows' were successfully downloaded.</span>

<span class="va">withlacoochee_temp_and_flow</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Wtemp_max'</span>, <span class="st">'Flow_max'</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">wy</span>, <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Water Year'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">name</span>, scale <span class="op">=</span> <span class="st">'free'</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-6-1.png" width="75%" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="stats">Stats<a class="anchor" aria-label="anchor" href="#stats"></a>
</h3>
<p>Sometimes you just want to compare the current flow (water year or past week, whatever you want) to historical flows. The <code><a href="reference/ww_statsUSGS.html">ww_statsUSGS()</a></code> function does this for you! It takes the historical values for your parameter (flow in this example) and returns percentiles (<code><a href="https://rdrr.io/pkg/dataRetrieval/man/readNWISstat.html" class="external-link">dataRetrieval::readNWISstat()</a></code>) but also combines the current values.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">yaak_river_dv</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ww_dvUSGS.html">ww_dvUSGS</a></span><span class="op">(</span><span class="st">'12304500'</span><span class="op">)</span>
<span class="co">#&gt; v Yaak River near Troy MT 'daily' was successfully downloaded.</span>

<span class="va">yaak_daily_report</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ww_statsUSGS.html">ww_statsUSGS</a></span><span class="op">(</span><span class="va">yaak_river_dv</span>, 
                                  temporalFilter <span class="op">=</span> <span class="st">'daily'</span>,
                                  days <span class="op">=</span> <span class="fl">365</span><span class="op">)</span>
<span class="co">#&gt; v Yaak River near Troy MT 'NWIS Stat' for Temporal Filter (daily) was successfully downloaded.</span>
<span class="va">yaak_daily_report</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Flow'</span>, <span class="st">'p25_va'</span>, <span class="st">'p75_va'</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">value</span>, color <span class="op">=</span> <span class="va">name</span>, alpha <span class="op">=</span> <span class="va">name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'p25_va'</span>, <span class="st">'p75_va'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'black'</span>, <span class="st">'red'</span>, <span class="st">'blue'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_alpha_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">.5</span><span class="op">)</span>, guide <span class="op">=</span> <span class="st">'none'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">'Discharge (cfs)'</span>, color <span class="op">=</span> <span class="st">''</span>, title <span class="op">=</span> <span class="st">'Comparing current flow to 25th and 75th percentiles'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-7-1.png" width="75%" style="display: block; margin: auto;"></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/joshualerickson/whitewater/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/joshualerickson/whitewater/issues/" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing whitewater</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Josh Erickson <br><small class="roles"> Author, maintainer, copyright holder </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/joshualerickson/whitewater/actions" class="external-link"><img src="https://github.com/joshualerickson/whitewater/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://app.codecov.io/gh/joshualerickson/whitewater" class="external-link"><img src="https://codecov.io/gh/joshualerickson/whitewater/branch/main/graph/badge.svg" alt="codecov"></a></li>
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#stable" class="external-link"><img src="https://img.shields.io/badge/lifecycle-experimental-brightgreen.svg" alt="Lifecycle: experimental"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Josh Erickson.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
